本周阅读论文《Self-supervised Equivariant Attention Mechanism
for Weakly Supervised Semantic Segmentation》以及相关的代码。



### 摘要



图像级弱监督语义分割是近年来深入研究的一个具有挑战性的问题。大多数解决方法都是采用类激活映射（CAM）。然而，由于全监督和弱监督之间的差距，gap几乎不能作用于object mask。在本文中，作者提出了一种自我监督的等变注意机制(SEAM)来发现额外的监督并缩小差距。作者的方法是基于等差是全监督语义分割中的一个隐含约束，其像素级标签在数据增强过程中采取与输入图像相同的空间变换。然而，这一约束在通过图像级监督训练的凸轮上就没有了。因此，作者提出对各种变换图像的预测凸轮进行一致性正则化，为网络学习提供自我监督。此外，作者还提出了像素关联模块(PCM)，该模块利用上下文外观信息，改进了相似邻域对当前像素的预测，进一步提高了凸轮的一致性。在Pascal  VOC 2012数据集上的大量实验表明，在相同的监督级别下，作者的方法比最先进的方法性能更好。



### 介绍



语义分割是一项基本的计算机视觉任务，其目的是预测图像的像素分类结果。由于近年来深度学习研究的蓬勃发展，语义分割模型的性能取得了很大的进步，促进了自动驾驶和医学图像分析等许多实际应用。然而，与分类、检测等其他任务相比，语义分割需要收集像素级的类标签，既耗时又昂贵。最近，许多努力致力于弱监督语义分割(WSSS)，它利用弱监督，例如图像级分类标签、涂鸦和边界框，试图获得与全监督方法同等的分割性能。本文主要研究基于图像级分类标签的语义分割。

据作者所知，大多数先进的WSSS方法都是基于类激活图(CAM)[39]的，这是一种通过图像分类标签来定位对象的有效方法。然而，凸轮通常只覆盖对象的最具识别性的部分，并且在背景区域中被错误地激活，这可以分别概括为欠激活和过度激活。此外，当用仿射变换对图像进行增强时，生成的凸轮并不一致。





![image-20200816152736999](D:\MarkDown\DeepLearning\img\image-20200816152736999.png)

如上图所示: 比较不同比例的输入图像生成的凸轮。(A)常规凸轮。(B)SEAM测的凸轮，在重新缩放时更加一致。



本文提出了一种自监督等变注意力机制(SEAM)来缩小上述监督差距。Seam对变换后的各种图像中的凸轮进行一致性正则化，为网络学习提供自我监督。为了进一步提高网络预测的一致性，Seam引入了像素相关模块(PCM)，该模块捕获每个像素的上下文外观信息，并通过学习的亲和力注意图来修正原始摄像头。SEAM由具有等变交叉正则化(ECR)损失的暹罗网络实现，该网络对不同分支上的原始凸轮和修改后的凸轮进行正则化。图1显示，作者的凸轮在各种变形的输入图像上都是一致的，没有比基线更少的过度激活和欠激活区域。



#### 论文的主要贡献

* 提出了一种自监督等变注意机制(SEAM)，将等变正则化和像素相关模块(PCM)相结合，缩小了完全监督语义分割和弱监督语义分割之间的监督差距。
* 采用等变交叉正则化(ECR)损耗的暹罗网络结构设计有效地耦合了PCM和自我监控，产生的CAM具有较少的过激活和欠激活区域。
* 在Pascal VOC 2012上的实验表明，作者的算法在只使用图像级标注的情况下达到了最先进的性能。



### 相关工作



#### 弱监督语义切分

与全监督学习相比，WSSS使用弱标签来指导网络训练，例如，边界框、涂鸦和图像级分类标签。一组先进的研究利用图像级分类标签来训练模型。它们大多对分类网络生成的类激活图(CAM)进行细化，以近似分割掩码。



#### 自我监督学习

自监督学习方法不是使用大量的标注标签来训练网络，而是设计借口任务来生成标签，而不需要额外的人工标注。这里有许多经典的自监督借口任务，例如，相对位置预测、空间变换预测、图像修复和图像彩色化。在某种程度上，生成式对抗性网络也可以看作是一种不需要人工标注鉴别器真实性标签的自监督学习方法。由借口任务生成的标签为网络提供自我监督，以学习更健壮的表示。通过自我监督学习的特征可以代替ImageNet在某些任务中预先训练的特征，例如检测和零件分割。考虑到完全监督和弱监督语义切分之间存在很大的监督差距，作者应该寻求额外的监督来缩小差距，这是一种直觉。由于图像级分类标签太弱，网络无法学习到符合目标边界的分割掩码，作者利用理想分割函数的等方差来设计伪装任务，为仅使用图像级标注的网络学习提供额外的自我监督。



### 方法介绍

![image-20200816154510896](D:\MarkDown\DeepLearning\img\image-20200816154510896.png)

作者提出的SEAM方法的网络体系结构。接缝是等变正则化(ER)的积分和像素相关模块(PCM)经过特殊设计的损失，修正后的凸轮不仅保持了仿射变换的一致性，而且很好地拟合了物体的轮廓。



####  Motivation



将理想的像素级语义分割函数表示为带参数ws的$F_{W_{s}}(.)$。对于每个图像样本I，分割过程可以表示为$F_{W_{s}}(I)=s$，其中s表示像素级分割掩模。这一提法在分类任务中也是一致的。利用附加的图像级标签l和池函数Pool(·)，分类任务可以表示为具有参数WC的$Pool(F_{W_{C}}(I))=l$。大多数WSSS方法都是基于这样的假设，即用于分类和分割的最佳参数满足$W_C=W_s$。因此，这些方法首先训练一个分类网络，然后去掉汇集函数来处理分割任务。

然而，不难发现，分类和分割函数的性质是不同的。假设每个样本都有一个函数变换A(·)，则分割函数更倾向于等变，即$F_{w_s}(A(I))=A(F_{w_s}(I))$。而分类任务更注重不变性，即$Pool(F_{W_C}(A(I)=l$。虽然分类函数的不变性主要是由汇集操作造成的，但$F_{W_C}(·)$没有等变约束，这使得在网络学习过程中几乎不可能达到分割函数的相同目标。应该集成额外的正则化工具，以缩小完全监督学习和弱监督学习之间的监督差距。

自我注意是一种被广泛接受的机制，可以显著提高网络逼近能力。它通过获取上下文特征依赖关系来修正特征图，这也符合大多数WSSS方法利用像素相似度来细化原始激活图的思想。

公式定义如下:

![image-20200816160617056](D:\MarkDown\DeepLearning\img\image-20200816160617056.png)



#### 等变正则化

在全监督语义分割的数据增强期，像素级标签应与输入图像采用相同的仿射变换。它为网络引入了隐式等变约束。然而，考虑到WSSS只能访问图像级分类标签，这里缺少隐式约束。

公式如下：

![image-20200816161251130](D:\MarkDown\DeepLearning\img\image-20200816161251130.png)

其中，F(·)表示网络，A(·)表示任何空间仿射变换，例如，重新缩放、旋转、翻转。为了在原有网络上集成正则化，作者将网络扩展为加权结构。一个分支将变换应用于网络输出，另一个分支在网络前馈之前通过相同的变换对图像进行扭曲。对两个分支的输出激活图进行了正则化处理，保证了凸轮的一致性。



#### 像素相关模块

尽管等变正则化为网络学习提供了额外的监督，但是仅通过经典卷积层很难实现理想的等变。自注意力是捕获上下文信息和细化像素方式的预测结果的有效模块。

![image-20200816162002464](D:\MarkDown\DeepLearning\img\image-20200816162002464.png)

为了通过上下文信息进一步细化原始CAM，作者在网络末端提出了一个像素相关模块（PCM），以集成每个像素的低级特征。  PCM的结构是指自我注意机制的核心部分，它经过了一些修改，并在等变正则化的监督下进行了训练。

![image-20200816162040408](D:\MarkDown\DeepLearning\img\image-20200816162040408.png)

在这里，作者采用归一化特征空间中的内积来计算当前像素i与其他像素之间的亲和力，

![image-20200816162113979](D:\MarkDown\DeepLearning\img\image-20200816162113979.png)

结构图如下所示：

![image-20200816162126276](D:\MarkDown\DeepLearning\img\image-20200816162126276.png)



### 实验

#### 实验细节

作者在PASCAL VOC 2012数据集上评估了作者的方法，该数据集具有21个类注释，即20个前景对象和背景。官方数据集分隔具有1464张图像进行训练，1449张图像进行验证和1456张图像进行测试。遵循常用的语义分割实验协议，作者从SBD [14]中采用了附加注释，以构建具有10582张图像的增强训练集。请注意，网络培训期间仅图像级别分类标签可用。联合平均交集（mIoU）被用作评估细分结果的指标。

![image-20200816162356267](D:\MarkDown\DeepLearning\img\image-20200816162356267.png)

改进的定位机制

直觉上，改进的弱监督定位机制将提高伪分段标签的mIoU。为了验证这个想法，作者在汇总建议的SEAM之前，先对GradCAM 和GradCAM ++ 进行评估。但是，评估结果由Tab给出。上表说明GradCAM和GradCAM ++都无法缩小完全监督和弱监督语义分割任务之间的监督差距，因为最好的mIoU结果没有改善。作者认为，改进的定位机制仅设计用于表示对象相关的部件，不受低级信息的任何约束，这不适合分割任务。通过这些改进的定位方法生成的CAM与地面真相掩模的匹配度越来越低。

![image-20200816162712202](D:\MarkDown\DeepLearning\img\image-20200816162712202.png)

作者使用更大的比例范围和Tab评估基线模型。实验结果表明，仅增加重缩放范围并不能提高生成的伪标签的准确性，这证明性能的提高来自PCM和等变正则化的组合，而不是数据扩充。在推论过程中，通常的做法是通过汇总来自不同比例尺的图像的预测结果以提高最终性能来采用多尺度测试。它也可以被视为一种改善预测等方差的方法。为了验证作者提出的SEAM的有效性，作者评估了单尺度和多尺度测试生成的CAM。标签。上表说明了作者提出的模型在单规模和多规模测试中均以更高的峰值性能胜过基线。



![image-20200816162839396](D:\MarkDown\DeepLearning\img\image-20200816162839396.png)

作者从基线和SEAM收集评估结果，然后在图中绘制曲线，该曲线说明了基线与作者的方法之间的巨大差距。  SEAM实现了更低的$m_{FN}$和$m_{FP}$，这意味着通过作者的方法生成的CAM具有更完整的激活覆盖范围和更少的过度激活像素。因此，SEAM的预测图更适合地面真实分割的形状。此外，在不同图像尺度上，SEAM的曲线比基线模型更一致，这证明等方差正则化在网络学习期间起作用，并有助于改善CAM.

实验效果图如下：

![image-20200816163027827](D:\MarkDown\DeepLearning\img\image-20200816163027827.png)

实验结果如下：

![image-20200816163105725](D:\MarkDown\DeepLearning\img\image-20200816163105725.png)

![image-20200816163126275](D:\MarkDown\DeepLearning\img\image-20200816163126275.png)