## 比特币中的密码原理

加密货币是不加密的，所有的信息都是公开的。比特币中主要用密码学中到两个功能：**哈希和签名**。



### Cryptographic hash function

x≠y  H(x)=H(y) 哈希碰撞，一般来说哈希碰撞时不可避免 的。举例来说一个256位的哈希函数，所有的可能性为$2^{256}$。可以通过穷举实现。

**（1）collection resistance**

通过collection resistance 可以实现如果H(m) =digest 那么找不到H(m')≠digest不被检测出来。也就是说当数据进行串改之后能够很轻易的发现哈希是串改的。也就是hash函数不能被人为的制造hash碰撞。

（2）hash**计算时单项性的**

$x->H(x)    $

$ H(x)-/->x$

通过 collection resistance 和 hiding 实现digital commitment。通过x->H(x) 把hash值公布出去，x私有，这样通过H(x)验证x的真实性。如果x的值有限，不能保证随机的话，要添加一个随机的数据进行hash值计算。

（3） hash值的计算时事先不可预知的。

比特币的挖矿其实就是找一个nonce，$H(block\ header) \le target$. 挖矿没有捷径，只能通过挖矿进行不断的试错。挖矿很难，验证很容易。

挖矿使用的是SHA256函数。



### 签名

比特币没有中心化的组织，由个人自行决定是否创建个人账户，本质上是创建一个公私钥对，使用不对称加密。公钥进行加密，私钥进行解密。公钥就相当于你的银行账号，私钥相当于你的密码。比特币不加密，但是交易要进行签名，比如我要进行比特币转账，A转10个比特币给B，那么如何证明是我转的呢，就要对这笔转账进行签名。A拿私钥对这笔交易进行签名，其他人使用A的公钥进行验证来进行验证。

要使用很好的随机源，将生成的公私钥账户能够很好的随机性，不会出现相同的公私钥。



## BTC-数据结构

### hash指针

区块链就是一个个区块连接成的链表。与普通链表不同是使用**hash指针**代替了普通指针。

![image-20200410100023980](D:\MarkDown\区块链\img\image-20200410100023980.png)

第一个是系统产生的**创世纪块**，最后一个是最近产生的区块。每个区块都包含指向前一个区块的hash指针。把前一个区块的内容和hash指针和在一起算出当前节点的hash指针，实现tamper-evident log，防篡改日志。

普通链表可以更改任意一个块中的内容，但是区块链只要修改任意一个区块就会出现多米诺骨牌效应。所以只需要保存最后一个区块的hash指针就可以了。

![image-20200410101124750](D:\MarkDown\区块链\img\image-20200410101124750.png)

只要记录根hash值就能验证任意一个的修改。block header存放的是交易的根hash值，block body存放具体的交易信息。

全节点保存所有的信息，轻节点保存block header。如何证明轻节点的交易信息，这时候就需要使用merkle proof。也就是一条交易的链路信息。（黄色的）

![image-20200410101746505](D:\MarkDown\区块链\img\image-20200410101746505.png)

![image-20200410101829437](D:\MarkDown\区块链\img\image-20200410101829437.png)

轻节点向某个全节点发送请求，请求证明黄色的交易是否存在，那么全节点只需要发送图上红色的hash值给轻节点就可以了。



![image-20200410102038702](D:\MarkDown\区块链\img\image-20200410102038702.png)

 ![image-20200410102130697](D:\MarkDown\区块链\img\image-20200410102130697.png)

![image-20200410102145456](D:\MarkDown\区块链\img\image-20200410102145456.png)

最后计算出根hash值，最后与节点中的根hash值进行相比。

proof of membership 时间复杂度$ log_2(n)$

![image-20200410104001766](D:\MarkDown\区块链\img\image-20200410104001766.png)

有环是不能使用hash指针。

